@model List<Book>

<div class="container" style="background-color: #f4f9ff;">
    <div class="row">
        <div class="col-12 text-center mb-4">
            <h1 class="text-primary">به کتابخانه آبی خوش آمدید!</h1>
            <p class="text-muted">
                اینجا می‌توانید کتاب‌های مورد علاقه خود را پیدا کرده و به لیست امانت یا خرید خود اضافه کنید.
            </p>
        </div>
    </div>

    <div class="row">
        @foreach (var book in Model)
        {
            <div class="col-lg-3 mb-4">
                <div class="card h-100 shadow d-flex flex-column">

                    <div class="card-body text-center">
                        <img src="/img/@(book.Id).jpg"
                         style="width:150px; height:222px; object-fit:cover;"
                         class="card-img-top mb-3"
                         alt="تصویر یافت نشد" />

                        <h5 class="card-title text-primary">@book.Name</h5>
                        <p class="card-text text-muted">@book.Description</p>

                        <span class="badge @(book.Type == BookType.Sale ? "bg-success" : "bg-primary")">
                            @(book.Type == BookType.Sale ? "فروشی" : "امانتی")
                        </span>
                    </div>

                    <div class="card-footer d-flex justify-content-between align-items-center p-3">
                        <div class="quantity-box">
                            <p class="mb-0">
                                موجودی: <strong>@book.AvailableQuantity</strong>
                            </p>
                        </div>

                        <div class="action-box">
                            @* ===== کتاب فروشی ===== *@
                            @if (book.Type == BookType.Sale)
                            {
                                if (book.AvailableQuantity > 0){
                                    <a asp-action="AddToCart"
                                    asp-controller="Cart"
                                    asp-route-bookId="@book.Id"
                                    class="btn btn-success">
                                    افزودن به سبد
                                    </a>
                                }
                                else
                                {
                                    <button class="btn btn-secondary" disabled>
                                        اتمام موجودی
                                    </button>
                                }
                            }
                            @* ===== کتاب امانتی ===== *@
                            else
                            {
                                if (book.AvailableQuantity > 0)
                                {
                                    <form asp-action="AddToBorrow"
                              asp-controller="Home"
                              method="post">
                                        <input type="hidden" name="bookId" value="@book.Id" />
                                        <button class="btn btn-primary">
                                            امانت گرفتن
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    var activeReserves = book.Reserves?.Count(r => r.IsActive) ?? 0;

                                    if (activeReserves < 2)
                                    {
                                        <form asp-action="AddToReserve"
                                            asp-controller="Home"
                                            method="post">
                                            <input type="hidden" name="bookId" value="@book.Id" />
                                            <button class="btn btn-warning">
                                                افزودن به رزرو
                                            </button>
                                        </form>
                                    }
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<style>
    body {
        background-color: #f4f9ff;
    }

    .card {
        border: none;
        border-radius: 10px;
        transition: all 0.3s ease;
    }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

    .btn {
        border-radius: 6px;
    }

    .quantity-box p {
        font-size: 14px;
        color: #007bff;
    }
</style>
